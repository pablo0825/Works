<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>公文控管系統</title>
  </head>
  <body>
    <% title = "查询文件" %> <%- include('partials/header.ejs') %>

    <form id="queryForm">
      <label for="fileNumber">文件编号：</label>
      <input type="text" id="fileNumber" name="fileNumber" required />
      <button id="querybtn" type="submit">提交</button>
    </form>

    <div id="newtable"></div>

    <script>
      const form = document.getElementById("queryForm");
      const dviflie = document.getElementById("newtable");

      form.addEventListener("submit", async (event) => {
        event.preventDefault(); // 阻止表单的默认提交行为

        const fileNumber = document.getElementById("fileNumber").value;

        try {
          const response = await fetch(
            `/api/documents/query?fileNumber=${fileNumber}`
          );
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "查询失败");
          }
          const data = await response.json();
          const docData = data.document; // 使用新的变量名

          // 清空之前的结果
          dviflie.innerHTML = "";

          // 创建表格
          const table = document.createElement("table");
          table.border = "1";

          const rows = [
            { label: "文件编号", value: docData.fileNumber },
            { label: "启动人", value: docData.user },
            { label: "主旨", value: docData.title },
            { label: "备注", value: docData.remark },
            { label: "目前单位", value: docData.currentUnit },
          ];

          rows.forEach((row) => {
            const tr = document.createElement("tr");
            const th = document.createElement("th");
            th.textContent = row.label;
            const td = document.createElement("td");
            td.textContent = row.value;
            tr.appendChild(th);
            tr.appendChild(td);
            table.appendChild(tr);
          });

          dviflie.appendChild(table);
        } catch (error) {
          dviflie.innerHTML = `<p style="color:red;">${error.message}</p>`;
        }
      });
    </script>
  </body>
</html>
